{% extends "base.html" %}
{% load url from future %}
{% load item_tags %}
{% load user_tags %}

{% block title %}{{ item }}{% endblock %}

{% block mainbar %}

{% spaceless %}
<h1>
{{ item }}
{% if item.primary_tags %} ({{ item.primary_tags|typeset_tag_list|join:", " }}){% endif %}
{% if item.parent %} of {{ item.parent }}{% endif %}
</h1>
{% endspaceless %}

<div class="itembody">
{{ item.body|typeset_body }}
</div>

<div class="iteminfo">
<p>{{ item.get_status_display }}, latest edit by <a href="{% url 'users.views.profile' item.created_by.get_username %}">{{ item.created_by.get_full_name }}</a> at {{ item.modified_at|datetime_user:user }}</p>
{% if item.secondary_tags %}
<div class="taglist">
{% for tag in item.secondary_tags %}
  <span class="tag">{{ tag|typeset_tag }}</span>
{% endfor %}
</div>
{% endif %}
</div>

<div class="clr"></div>

{% endblock mainbar %}

{% block sidebar %}

<div class="actions">
{% if perm.edit %}
<a class="button" href="{% url 'items.views.edit' item.id %}">edit</a>
<div class="clr"></div>
{% endif %}
{% if perm.to_draft %}
<form method="post" action="{% url 'items.views.change_status' %}">
  {% csrf_token %}
  <input class="button" type="submit" value="revert to draft" />
  <input type="hidden" name="status" value="draft" />
  <input type="hidden" name="item" value="{{ item.id }}" />
</form>
<div class="clr"></div>
{% endif %}
{% if perm.to_review %}
<form method="post" action="{% url 'items.views.change_status' %}">
  {% csrf_token %}
  <input class="button" type="submit" value="submit for review" />
  <input type="hidden" name="status" value="review" />
  <input type="hidden" name="item" value="{{ item.id }}" />
</form>
<div class="clr"></div>
{% endif %}
{% if perm.to_final %}
<form method="post" action="{% url 'items.views.change_status' %}">
  {% csrf_token %}
  <input class="button" type="submit" value="publish" />
  <input type="hidden" name="status" value="publish" />
  <input type="hidden" name="item" value="{{ item.id }}" />
</form>
<div class="clr"></div>
{% endif %}
</div>

{% endblock %}
