{% extends "base.html" %}

{% block title %}teoremer.com | search{% endblock %}

{% block mainbar %}

<div id="search-container">
{% include 'include/item_list.html' with itempage=itempage only %}
</div>

{% endblock %}

{% block sidebar %}

<h4>Type</h4>

<ul class="list-unstyled">
    <li>{% if links.type.all %}
      <span class="glyphicon glyphicon-ok transparent"></span> <a href="{{links.type.all}}">All</a>
    {% else %}
      <span class="glyphicon glyphicon-ok"></span> All
    {% endif %}</li>
    <li>{% if links.type.D %}
      <span class="glyphicon glyphicon-ok transparent"></span> <a href="{{links.type.D}}">Definitions</a>
    {% else %}
      <span class="glyphicon glyphicon-ok"></span> Definitions
    {% endif %}</li>
    <li>{% if links.type.T %}
      <span class="glyphicon glyphicon-ok transparent"></span> <a href="{{links.type.T}}">Theorems</a>
    {% else %}
      <span class="glyphicon glyphicon-ok"></span> Theorems
    {% endif %}</li>
    <li>{% if links.type.P %}
      <span class="glyphicon glyphicon-ok transparent"></span> <a href="{{links.type.P}}">Proofs</a>
    {% else %}
      <span class="glyphicon glyphicon-ok"></span> Proofs
    {% endif %}</li>
</ul>

<h4>Status</h4>

<ul class="list-unstyled">
    <li>{% if links.status.all %}
      <span class="glyphicon glyphicon-ok transparent"></span> <a href="{{links.status.all}}">All</a>
    {% else %}
      <span class="glyphicon glyphicon-ok"></span> All
    {% endif %}</li>
    <li>{% if links.status.F %}
      <span class="glyphicon glyphicon-ok transparent"></span> <a href="{{links.status.F}}">Published</a>
    {% else %}
      <span class="glyphicon glyphicon-ok"></span> Published
    {% endif %}</li>
    <li>{% if links.status.R %}
      <span class="glyphicon glyphicon-ok transparent"></span> <a href="{{links.status.R}}">Under review</a>
    {% else %}
      <span class="glyphicon glyphicon-ok"></span> Under review
    {% endif %}</li>
</ul>

<h4>Sorting</h4>

<ul class="list-unstyled">
    <li><span class="glyphicon glyphicon-ok"></span> Date</li>
    <li><span class="glyphicon glyphicon-ok transparent"></span> <a href="">Points</a></li>
</ul>

{% endblock %}

{% block bodybottom %}
<script type="text/javascript">
(function ($container) {
    function add_to_query(url) {
        return url + (url.indexOf("?") < 0 ? "?" : "&") + "fragment=true";
    }
    function init_load_handler($elem, direction) {
        if ($elem.attr('href')) {
            $elem.removeClass('hidden');
            $elem.click(function (event) {
                event.preventDefault();
                $elem.addClass('hidden');
                var data_url = add_to_query($elem.attr('href'));
                $.getJSON(data_url)
                    .done(function (data) {
                        if (direction === 'up') {
                            $container.find('ul').prepend(data.items);
                            data_url = data.prev_data_url;
                        } else {
                            $container.find('ul').append(data.items);
                            data_url = data.next_data_url;
                        }
                        $elem.attr('href', data_url);
                        if (data_url)
                            $elem.removeClass('hidden');
                    });
            });
        }
    }

    $container.find('a.prev-link').each(function () {
        init_load_handler($(this), 'up');
    });
    $container.find('a.next-link').each(function () {
        init_load_handler($(this), 'down');
    });

    var last_scroll = 0;
    $(window).scroll(function () {
        var scroll_pos = $(window).scrollTop();
        var window_height = $(window).height();
        var window_middle = scroll_pos + 0.5 * window_height;
        if (Math.abs(scroll_pos - last_scroll) > 0.1 * window_height) {
            last_scroll = scroll_pos;
            $container.find('.itempage').each(function (index) {
                var el_top = $(this).offset().top;
                var el_height = $(this).height();
                if (window_middle >= el_top && window_middle < el_top + el_height) {
                    history.replaceState(null, null, $(this).data("url"));
                    return(false);
                }
            });
        }
    });

})($('#search-container'));
</script>
{% endblock %}
