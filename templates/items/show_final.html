{% extends "base.html" %}
{% load staticfiles %}
{% load item_tags %}
{% load user_tags %}
{% load utils_tags %}

{% block title %}{{ item }}{% endblock %}

{% block mainbar %}

<h1>{{ item }}
{% if item.parent %} of <a href="{% url 'items.views.show_final' item.parent.final_id %}">{{ item.parent }}</a>{% endif %}</h1>
{% include 'items/include/categories.html' with categories=item.primary_categories only %}

<div class="item-body">
{{ item|typeset_body }}
</div>

<h4 class="expander-in">{{ validations|length }} validation{{ validations|length|pluralize }}</h4>
<div id="validation-list"></div>

{% if item.itemtype == 'T' %}
{% if proof_list %}
<div class="item-count">{{ proof_count }} proofs (<a href="{% url 'items.views.show_final' item.final_id %}">hide</a>)</div>
{% for proof in proof_list %}
<p>
    <a href="{% url 'items.views.show_final' proof.final_id %}">{{ proof }}</a>
</p>
{% endfor %}
{% elif proof_count %}
<div class="item-count">{{ proof_count }} proofs (<a href="{% url 'items.views.show_final' item.final_id %}?prfs=1">show</a>)</div>
{% else %}
<div class="item-count">no proofs</div>
{% endif %}
{% endif %}

{% endblock mainbar %}

{% block sidebar %}

<h4>Meta</h4>

<p>
Created by <a href="{% url 'users.views.profile' item.created_by.get_username %}">{{ item.created_by.get_full_name }}</a>,
published at {{ item.created_at|datetime_user:user }}
{% if item.created_at == item.modified_at %} (unmodified){% else %}, modified at {{ item.modified_at|datetime_user:user }}{% endif %}
</p>

<h4>Categories</h4>

{% include 'items/include/categories.html' with categories=item.secondary_categories only %}

<h4>Actions</h4>

{% if perm.add_proof %}
<p><a class="btn btn-primary" href="{% url 'drafts.views.new' kind='proof' parent=item.final_id %}">Add proof</a></p>
{% endif %}
{% if perm.add_source %}
<p><a class="btn btn-primary" href="{% url 'sources.views.add_source_for_item' item.final_id %}">Add validation source</a></p>
{% endif %}
{% if perm.edit_final %}
<p><a class="btn btn-primary" href="{% url 'items.views.edit_final' item.final_id %}">Edit</a></p>
{% endif %}
{% if user.is_admin %}
<form method="post" action="{% url 'items.views.delete_public' %}">
  {% csrf_token %}
  <button class="btn btn-danger" type="submit">Delete</button>
  <input type="hidden" name="item" value="{{ item.id }}" />
</form>
{% endif %}

{% endblock %}

{% block bodybottom %}

<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0-rc.3/handlebars.min.js"></script>
<script src="{% static 'js/teoremer.js' %}"></script>

<script type="text/javascript">

(function() {

  new teoremer.ValidationListView({
    el: $('#validation-list'),
    collection: new teoremer.ValidationList({{validations|to_json}})
  });

})();

</script>

{% endblock %}
