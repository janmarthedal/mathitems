{% extends "base.html" %}
{% load item_tags %}
{% load user_tags %}
{% load utils_tags %}

{% block title %}{{ item }}{% endblock %}

{% block mainbar %}

<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">{{ item }}{% if item.parent %} of <a href="{% url 'items.views.show_final' item.parent.final_id %}">{{ item.parent }}</a>{% endif %}</h4>
  </div>
  <div class="panel-body">
{{ item|typeset_body }}
  </div>
</div>

{% include 'include/categories.html' with categories=item.primary_categories no_categories_text="No primary categories" only %}

{% if validations %}
<h4 class="expander-in">{{ validations|length }} validation{{ validations|length|pluralize }} <span class="glyphicon"></span></h4>
<div id="validation-list"></div>
{% else %}
<h4>No validations</h4>
{% endif %}

{% if item.itemtype == "T" %}
{% if proof_count %}
<h4 class="expander-in">{{ proof_count }} proof{{ proof_count|pluralize }} <span class="glyphicon"></span></h4>
<div id="proof-list"></div>
{% else %}
<h4>No proofs</h4>
{% endif %}
{% endif %}

{% endblock mainbar %}

{% block sidebar %}

<h4>Meta</h4>

<div>
Created by <a href="{% url 'users.views.profile' item.created_by.get_username %}">{{ item.created_by.get_full_name }}</a>,
published at {{ item.created_at|datetime_user:user }}
{% if item.created_at == item.modified_at %} (unmodified){% else %}, modified at {{ item.modified_at|datetime_user:user }}{% endif %}
</div>

<div id="item-points"></div>

<h4>Categories</h4>

{% include 'include/categories.html' with categories=item.secondary_categories no_categories_text="None" only %}

<h4>Actions</h4>

{% if allow.add_proof %}
<p><a class="btn btn-primary" href="{% url 'drafts.views.new' kind='proof' parent=item.final_id %}"><i class="fa fa-plus"></i> Add proof</a></p>
{% endif %}
{% if allow.add_source %}
<p><a class="btn btn-primary" href="{% url 'sources.views.add_source_for_item' item.final_id %}"><i class="fa fa-plus"></i> Add source validation</a></p>
{% endif %}
{% if allow.change_cats %}
<p><a class="btn btn-primary" href="{% url 'items.views.edit_final' item.final_id %}"><i class="fa fa-pencil"></i> Change categories</a></p>
{% endif %}
{% if allow.delete %}
<p><form method="post" action="{% url 'items.views.delete_final' item.final_id %}">
  {% csrf_token %}
  <button class="btn btn-danger" type="submit"><i class="fa fa-trash-o"></i> Delete</button>
  <input type="hidden" name="item" value="{{ item.final_id }}" />
</form></p>
{% endif %}
{% if allow.add_to_doc %}
<p><div class="btn-group">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
    <i class="fa fa-plus"></i> Add to document <span class="caret"></span>
  </button>
  <ul id="add-to-document" class="dropdown-menu" role="menu">
{% if documents %}
{%   for doc in documents %}
    <li><a href="#" data-doc="{{doc.id}}">{{doc}}</a></li>
{%   endfor %}
    <li class="divider"></li>
{% endif %}
    <li><a href="#"><i>New document</i></a></li>
  </ul>
</div></p>
{% endif %}

{% endblock %}

{% block bodybottom %}

{% include 'include/js-scripts.html' %}

<script type="text/javascript">
teoremer.show_final({{validations|to_json}}, { id: '{{ item.final_id }}', points: {{item.points}} },
{{ user_id|default:'undefined' }}
{% if item.itemtype == 'T' %}, {{init_proofs|to_json}}{% endif %});
</script>

{% endblock %}
