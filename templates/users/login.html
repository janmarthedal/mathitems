{% extends "base.html" %}

{% block headblock %}
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-social/4.0.6/bootstrap-social.min.css" />
{% endblock %}

{% block title %}Log in{% endblock %}

{% block mainbar %}

<h3>{% if invited %}Welcome as a new beta user!{% else %}Registrered user?{% endif %}</h3>

<p>{% if invited %}Choose an authentication provider to use when logging in:
{% else %}Log in using your authentication provider:{% endif %}</p>
<div class="row">
  <div class="col-md-4">
    <a class="btn btn-block btn-social btn-google-plus" rel="nofollow" href="{% url 'social:begin' 'google' %}">
      <i class="fa fa-google-plus"></i> Sign in with Google
    </a>
    <a class="btn btn-block btn-social btn-twitter" rel="nofollow" href="{% url 'social:begin' 'twitter' %}">
      <i class="fa fa-twitter"></i> Sign in with Twitter
    </a>
    <a class="btn btn-block btn-social btn-facebook" rel="nofollow" href="{% url 'social:begin' 'facebook' %}">
      <i class="fa fa-facebook"></i> Sign in with Facebook
    </a>
    <a class="btn btn-block btn-social btn-linkedin" rel="nofollow" href="{% url 'social:begin' 'linkedin' %}">
      <i class="fa fa-linkedin"></i> Sign in with LinkedIn
    </a>
    <form method="post" action="{% url 'social:complete' 'persona' %}" style="padding-top: 5px;">
      {% csrf_token %}
      <input type="hidden" name="assertion" value="" />
      <a class="btn btn-block btn-social btn-persona" rel="nofollow" id="persona" href="#"><i class="fa fa-user"></i> Sign in with Persona</a>
    </form>
  </div>
</div>

{% if not invited %}
<h3>New user?</h3>

<p><b>teoremer</b> is currently in a closed beta phase. This means that the site is fairly
  feature complete, but with some limitations and probably bugs (many more features are
  in the pipeline, however). To improve, test and stabilize the software, new users are most
  welcome to sign up as beta testers.</p>

<p>If you are interested in getting an account, please send an email to
  <a href="mailto:beta@teoremer.com">beta@teoremer.com</a> and tell us:
  <ul>
    <li>Your name</li>
    <li>The email address you wish to use for login (if different from your sender address)</li>
    <li>Short background (only for internal use; are you a student, teacher, researcher, other?)</li>
  </ul></p>
{% endif %}

{% endblock %}

{% block bodybottom %}
<script src="https://login.persona.org/include.js" type="text/javascript"></script>

<!-- Mozilla Persona -->
<script type="text/javascript">
  $(function () {
      $('#persona').on('click', function (e) {
          e.preventDefault();
          var self = $(this);
          navigator.id.get(function (assertion) {
              if (assertion) {
                  self.parent('form')
                          .find('input[type=hidden]')
                          .attr('value', assertion)
                          .end()
                      .submit();
              } else {
                  alert('Some error occurred');
              }
          });
      });
  });
</script>
{% endblock %}
