{% extends "base.html" %}

{% block headblock %}
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/webicons/2.0.0/webicons.min.css" />
{% endblock %}

{% block title %}Log in{% endblock %}

{% block mainbar %}

<h3>{% if invited %}Welcome as a new beta user!{% else %}Registrered user?{% endif %}</h3>

<p>Choose your login method:</p>
<p class="no-svg">
  <a class="webicon google large" rel="nofollow" href="{% url 'social:begin' 'google' %}">Google</a>
  <a class="webicon twitter large" rel="nofollow" href="{% url 'social:begin' 'twitter' %}">Twitter</a>
  <a class="webicon facebook large" rel="nofollow" href="{% url 'social:begin' 'facebook' %}">Facebook</a>
  <a class="webicon linkedin large" rel="nofollow" href="{% url 'social:begin' 'linkedin' %}">LinkedIn</a>
</p>

<form method="post" action="{% url 'social:complete' 'persona' %}">
  {% csrf_token %}
  <input type="hidden" name="assertion" value="" />
  <a class="btn btn-default" rel="nofollow" id="persona" href="#"><span class="glyphicon glyphicon-user"></span> Email</a>
</form>

{% if not invited %}
<h3>New user?</h3>

<p><b>teoremer</b> is currently in a closed beta stage. This means that new users are created by
    invitation only. Read more <a href="http://blog.teoremer.com/2014/02/05/beta-now-live.html">on
    the blog</a>.</p>
{% endif %}

{% endblock %}

{% block bodybottom %}
<script src="https://login.persona.org/include.js" type="text/javascript"></script>

<!-- Mozilla Persona -->
<script type="text/javascript">
  $(function () {
      $('#persona').on('click', function (e) {
          e.preventDefault();
          var self = $(this);
          navigator.id.get(function (assertion) {
              if (assertion) {
                  self.parent('form')
                          .find('input[type=hidden]')
                          .attr('value', assertion)
                          .end()
                      .submit();
              } else {
                  console.log('Persona login: Some error occurred');
              }
          });
      });
  });
</script>
{% endblock %}
