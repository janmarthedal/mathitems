{% extends "base.html" %}

{% block headblock %}
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-social/4.2.1/bootstrap-social.min.css">
{% endblock %}

{% block title %}Log in{% endblock %}

{% block mainbar %}

<h3>{% if invited %}Welcome as a new beta user!{% else %}Registrered user?{% endif %}</h3>

<p>Choose your login method:</p>

<div class="row">
    <div class="col-sm-4">
        <p><a class="btn btn-block btn-social btn-google-plus" rel="nofollow" href="{% url 'social:begin' 'google' %}">
            <i class="fa fa-google-plus"></i> Sign in with Google</a></p>
        <p><a class="btn btn-block btn-social btn-twitter" rel="nofollow" href="{% url 'social:begin' 'twitter' %}">
            <i class="fa fa-twitter"></i> Sign in with Twitter</a></p>
        <p><a class="btn btn-block btn-social btn-facebook" rel="nofollow" href="{% url 'social:begin' 'facebook' %}">
            <i class="fa fa-facebook"></i> Sign in with Facebook</a></p>
        {% comment %}<p><a class="btn btn-block btn-social btn-linkedin" rel="nofollow" href="{% url 'social:begin' 'linkedin' %}">
            <i class="fa fa-linkedin"></i> Sign in with LinkedIn</a></p>{% endcomment %}
        <p><a class="btn btn-block btn-social btn-tumblr" rel="nofollow" id="persona" href="#">
              <i class="fa fa-envelope"></i> Email</a></p>

        <form method="post" action="{% url 'social:complete' 'persona' %}" id="persona-form">
            {% csrf_token %}
            <input type="hidden" name="assertion" value="">
        </form>
    </div>
</div>

{% if not invited %}
<h3>New user?</h3>

<p><b>teoremer</b> is currently in a closed beta stage. This means that new users are created by
    invitation only. Read more <a href="http://blog.teoremer.com/2014/02/05/beta-now-live.html">on
    the blog</a>.</p>
{% endif %}

{% endblock %}

{% block bodybottom %}
<script src="https://login.persona.org/include.js" type="text/javascript"></script>

<!-- Mozilla Persona -->
<script type="text/javascript">
  $(function () {
      $('#persona').on('click', function (e) {
          e.preventDefault();
          navigator.id.get(function (assertion) {
              if (assertion) {
                  $('#persona-form')
                        .find('input[type=hidden]')
                        .attr('value', assertion)
                        .end()
                        .submit();
              } else {
                  console.log('Persona login: Some error occurred');
              }
          });
      });
  });
</script>
{% endblock %}
