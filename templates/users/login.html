{% extends "base.html" %}

{% block headblock %}
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/webicons/2.0.0/webicons.min.css" />
{% endblock %}

{% block title %}Log in{% endblock %}

{% block mainbar %}

<h3>{% if invited %}Welcome as a new beta user!{% else %}Registrered user?{% endif %}</h3>

<p>{% if invited %}Choose an authentication provider to use when logging in:
{% else %}Log in using your authentication provider:{% endif %}</p>
<p class="no-svg">
  <a class="webicon google" rel="nofollow" href="{% url 'social:begin' 'google' %}">Google</a>
  <a class="webicon twitter" rel="nofollow" href="{% url 'social:begin' 'twitter' %}">Twitter</a>
  <a class="webicon facebook" rel="nofollow" href="{% url 'social:begin' 'facebook' %}">Facebook</a>
  <a class="webicon linkedin" rel="nofollow" href="{% url 'social:begin' 'linkedin' %}">LinkedIn</a>
</p>

<form method="post" action="{% url 'social:complete' 'persona' %}" style="padding-top: 5px;">
  {% csrf_token %}
  <input type="hidden" name="assertion" value="" />
  <a class="btn btn-default" rel="nofollow" id="persona" href="#"><span class="glyphicon glyphicon-user"></span> Email</a>
</form>

{% if not invited %}
<h3>New user?</h3>

<p><b>teoremer</b> is currently in a closed beta phase. This means that the site is fairly
  feature complete, but with some limitations and probably bugs (many more features are
  in the pipeline, however). To improve, test and stabilize the software, new users are most
  welcome to sign up as beta testers.</p>

<p>If you are interested in getting an account, please send an email to
  <a href="mailto:team@teoremer.com">team@teoremer.com</a> and tell us:
  <ul>
    <li>Your name</li>
    <li>The email address you wish to use for login (if different from your sender address)</li>
    <li>Short background (only for internal use; are you a student, teacher, researcher, other?)</li>
  </ul></p>
{% endif %}

{% endblock %}

{% block bodybottom %}
<script src="https://login.persona.org/include.js" type="text/javascript"></script>

<!-- Mozilla Persona -->
<script type="text/javascript">
  $(function () {
      $('#persona').on('click', function (e) {
          e.preventDefault();
          var self = $(this);
          navigator.id.get(function (assertion) {
              if (assertion) {
                  self.parent('form')
                          .find('input[type=hidden]')
                          .attr('value', assertion)
                          .end()
                      .submit();
              } else {
                  console.log('Persona login: Some error occurred');
              }
          });
      });
  });
</script>
{% endblock %}
